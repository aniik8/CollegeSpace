{"ast":null,"code":"/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module table/tablecellproperties/tablecellpropertiesui\n */\nimport { Plugin } from 'ckeditor5/src/core';\nimport { ButtonView, clickOutsideHandler, ContextualBalloon, getLocalizedColorOptions, normalizeColorOptions } from 'ckeditor5/src/ui';\nimport TableCellPropertiesView from './ui/tablecellpropertiesview';\nimport { colorFieldValidator, getLocalizedColorErrorText, getLocalizedLengthErrorText, defaultColors, lengthFieldValidator, lineWidthFieldValidator } from '../utils/ui/table-properties';\nimport { debounce } from 'lodash-es';\nimport { getTableWidgetAncestor } from '../utils/ui/widget';\nimport { getBalloonCellPositionData, repositionContextualBalloon } from '../utils/ui/contextualballoon';\nimport tableCellProperties from './../../theme/icons/table-cell-properties.svg';\nimport { getNormalizedDefaultProperties } from '../utils/table-properties';\nconst ERROR_TEXT_TIMEOUT = 500; // Map of view properties and related commands.\n\nconst propertyToCommandMap = {\n  borderStyle: 'tableCellBorderStyle',\n  borderColor: 'tableCellBorderColor',\n  borderWidth: 'tableCellBorderWidth',\n  width: 'tableCellWidth',\n  height: 'tableCellHeight',\n  padding: 'tableCellPadding',\n  backgroundColor: 'tableCellBackgroundColor',\n  horizontalAlignment: 'tableCellHorizontalAlignment',\n  verticalAlignment: 'tableCellVerticalAlignment'\n};\n/**\n * The table cell properties UI plugin. It introduces the `'tableCellProperties'` button\n * that opens a form allowing to specify the visual styling of a table cell.\n *\n * It uses the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon plugin}.\n *\n * @extends module:core/plugin~Plugin\n */\n\nexport default class TableCellPropertiesUI extends Plugin {\n  /**\n   * @inheritDoc\n   */\n  static get requires() {\n    return [ContextualBalloon];\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  static get pluginName() {\n    return 'TableCellPropertiesUI';\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  constructor(editor) {\n    super(editor);\n    editor.config.define('table.tableCellProperties', {\n      borderColors: defaultColors,\n      backgroundColors: defaultColors\n    });\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  init() {\n    const editor = this.editor;\n    const t = editor.t;\n    /**\n     * The default table cell properties.\n     *\n     * @protected\n     * @member {module:table/tablecellproperties~TableCellPropertiesOptions}\n     */\n\n    this._defaultTableCellProperties = getNormalizedDefaultProperties(editor.config.get('table.tableCellProperties.defaultProperties'), {\n      includeVerticalAlignmentProperty: true,\n      includeHorizontalAlignmentProperty: true,\n      includePaddingProperty: true,\n      isRightToLeftContent: editor.locale.contentLanguageDirection === 'rtl'\n    });\n    /**\n     * The contextual balloon plugin instance.\n     *\n     * @private\n     * @member {module:ui/panel/balloon/contextualballoon~ContextualBalloon}\n     */\n\n    this._balloon = editor.plugins.get(ContextualBalloon);\n    /**\n     * The cell properties form view displayed inside the balloon.\n     *\n     * @member {module:table/tablecellproperties/ui/tablecellpropertiesview~TableCellPropertiesView}\n     */\n\n    this.view = this._createPropertiesView();\n    /**\n     * The batch used to undo all changes made by the form (which are live, as the user types)\n     * when \"Cancel\" was pressed. Each time the view is shown, a new batch is created.\n     *\n     * @protected\n     * @member {module:engine/model/batch~Batch}\n     */\n\n    this._undoStepBatch = null;\n    editor.ui.componentFactory.add('tableCellProperties', locale => {\n      const view = new ButtonView(locale);\n      view.set({\n        label: t('Cell properties'),\n        icon: tableCellProperties,\n        tooltip: true\n      });\n      this.listenTo(view, 'execute', () => this._showView());\n      const commands = Object.values(propertyToCommandMap).map(commandName => editor.commands.get(commandName));\n      view.bind('isEnabled').toMany(commands, 'isEnabled', function () {\n        for (var _len = arguments.length, areEnabled = new Array(_len), _key = 0; _key < _len; _key++) {\n          areEnabled[_key] = arguments[_key];\n        }\n\n        return areEnabled.some(isCommandEnabled => isCommandEnabled);\n      });\n      return view;\n    });\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  destroy() {\n    super.destroy(); // Destroy created UI components as they are not automatically destroyed.\n    // See https://github.com/ckeditor/ckeditor5/issues/1341.\n\n    this.view.destroy();\n  }\n  /**\n   * Creates the {@link module:table/tablecellproperties/ui/tablecellpropertiesview~TableCellPropertiesView} instance.\n   *\n   * @private\n   * @returns {module:table/tablecellproperties/ui/tablecellpropertiesview~TableCellPropertiesView} The cell\n   * properties form view instance.\n   */\n\n\n  _createPropertiesView() {\n    const editor = this.editor;\n    const viewDocument = editor.editing.view.document;\n    const config = editor.config.get('table.tableCellProperties');\n    const borderColorsConfig = normalizeColorOptions(config.borderColors);\n    const localizedBorderColors = getLocalizedColorOptions(editor.locale, borderColorsConfig);\n    const backgroundColorsConfig = normalizeColorOptions(config.backgroundColors);\n    const localizedBackgroundColors = getLocalizedColorOptions(editor.locale, backgroundColorsConfig);\n    const view = new TableCellPropertiesView(editor.locale, {\n      borderColors: localizedBorderColors,\n      backgroundColors: localizedBackgroundColors,\n      defaultTableCellProperties: this._defaultTableCellProperties\n    });\n    const t = editor.t; // Render the view so its #element is available for the clickOutsideHandler.\n\n    view.render();\n    this.listenTo(view, 'submit', () => {\n      this._hideView();\n    });\n    this.listenTo(view, 'cancel', () => {\n      // https://github.com/ckeditor/ckeditor5/issues/6180\n      if (this._undoStepBatch.operations.length) {\n        editor.execute('undo', this._undoStepBatch);\n      }\n\n      this._hideView();\n    }); // Close the balloon on Esc key press.\n\n    view.keystrokes.set('Esc', (data, cancel) => {\n      this._hideView();\n\n      cancel();\n    }); // Reposition the balloon or hide the form if a table cell is no longer selected.\n\n    this.listenTo(editor.ui, 'update', () => {\n      if (!getTableWidgetAncestor(viewDocument.selection)) {\n        this._hideView();\n      } else if (this._isViewVisible) {\n        repositionContextualBalloon(editor, 'cell');\n      }\n    }); // Close on click outside of balloon panel element.\n\n    clickOutsideHandler({\n      emitter: view,\n      activator: () => this._isViewInBalloon,\n      contextElements: [this._balloon.view.element],\n      callback: () => this._hideView()\n    });\n    const colorErrorText = getLocalizedColorErrorText(t);\n    const lengthErrorText = getLocalizedLengthErrorText(t); // Create the \"UI -> editor data\" binding.\n    // These listeners update the editor data (via table commands) when any observable\n    // property of the view has changed. They also validate the value and display errors in the UI\n    // when necessary. This makes the view live, which means the changes are\n    // visible in the editing as soon as the user types or changes fields' values.\n\n    view.on('change:borderStyle', this._getPropertyChangeCallback('tableCellBorderStyle', this._defaultTableCellProperties.borderStyle));\n    view.on('change:borderColor', this._getValidatedPropertyChangeCallback({\n      viewField: view.borderColorInput,\n      commandName: 'tableCellBorderColor',\n      errorText: colorErrorText,\n      validator: colorFieldValidator,\n      defaultValue: this._defaultTableCellProperties.borderColor\n    }));\n    view.on('change:borderWidth', this._getValidatedPropertyChangeCallback({\n      viewField: view.borderWidthInput,\n      commandName: 'tableCellBorderWidth',\n      errorText: lengthErrorText,\n      validator: lineWidthFieldValidator,\n      defaultValue: this._defaultTableCellProperties.borderWidth\n    }));\n    view.on('change:padding', this._getValidatedPropertyChangeCallback({\n      viewField: view.paddingInput,\n      commandName: 'tableCellPadding',\n      errorText: lengthErrorText,\n      validator: lengthFieldValidator,\n      defaultValue: this._defaultTableCellProperties.padding\n    }));\n    view.on('change:width', this._getValidatedPropertyChangeCallback({\n      viewField: view.widthInput,\n      commandName: 'tableCellWidth',\n      errorText: lengthErrorText,\n      validator: lengthFieldValidator,\n      defaultValue: this._defaultTableCellProperties.width\n    }));\n    view.on('change:height', this._getValidatedPropertyChangeCallback({\n      viewField: view.heightInput,\n      commandName: 'tableCellHeight',\n      errorText: lengthErrorText,\n      validator: lengthFieldValidator,\n      defaultValue: this._defaultTableCellProperties.height\n    }));\n    view.on('change:backgroundColor', this._getValidatedPropertyChangeCallback({\n      viewField: view.backgroundInput,\n      commandName: 'tableCellBackgroundColor',\n      errorText: colorErrorText,\n      validator: colorFieldValidator,\n      defaultValue: this._defaultTableCellProperties.backgroundColor\n    }));\n    view.on('change:horizontalAlignment', this._getPropertyChangeCallback('tableCellHorizontalAlignment', this._defaultTableCellProperties.horizontalAlignment));\n    view.on('change:verticalAlignment', this._getPropertyChangeCallback('tableCellVerticalAlignment', this._defaultTableCellProperties.verticalAlignment));\n    return view;\n  }\n  /**\n   * In this method the \"editor data -> UI\" binding is happening.\n   *\n   * When executed, this method obtains selected cell property values from various table commands\n   * and passes them to the {@link #view}.\n   *\n   * This way, the UI stays up–to–date with the editor data.\n   *\n   * @private\n   */\n\n\n  _fillViewFormFromCommandValues() {\n    const commands = this.editor.commands;\n    const borderStyleCommand = commands.get('tableCellBorderStyle');\n    Object.entries(propertyToCommandMap).map(_ref => {\n      let [property, commandName] = _ref;\n      const defaultValue = this._defaultTableCellProperties[property] || '';\n      return [property, commands.get(commandName).value || defaultValue];\n    }).forEach(_ref2 => {\n      let [property, value] = _ref2;\n\n      // Do not set the `border-color` and `border-width` fields if `border-style:none`.\n      if ((property === 'borderColor' || property === 'borderWidth') && borderStyleCommand.value === 'none') {\n        return;\n      }\n\n      this.view.set(property, value);\n    });\n  }\n  /**\n   * Shows the {@link #view} in the {@link #_balloon}.\n   *\n   * **Note**: Each time a view is shown, a new {@link #_undoStepBatch} is created. It contains\n   * all changes made to the document when the view is visible, allowing a single undo step\n   * for all of them.\n   *\n   * @protected\n   */\n\n\n  _showView() {\n    const editor = this.editor; // Update the view with the model values.\n\n    this._fillViewFormFromCommandValues();\n\n    this._balloon.add({\n      view: this.view,\n      position: getBalloonCellPositionData(editor)\n    }); // Create a new batch. Clicking \"Cancel\" will undo this batch.\n\n\n    this._undoStepBatch = editor.model.createBatch(); // Basic a11y.\n\n    this.view.focus();\n  }\n  /**\n   * Removes the {@link #view} from the {@link #_balloon}.\n   *\n   * @protected\n   */\n\n\n  _hideView() {\n    if (!this._isViewInBalloon) {\n      return;\n    }\n\n    const editor = this.editor;\n    this.stopListening(editor.ui, 'update'); // Blur any input element before removing it from DOM to prevent issues in some browsers.\n    // See https://github.com/ckeditor/ckeditor5/issues/1501.\n\n    this.view.saveButtonView.focus();\n\n    this._balloon.remove(this.view); // Make sure the focus is not lost in the process by putting it directly\n    // into the editing view.\n\n\n    this.editor.editing.view.focus();\n  }\n  /**\n   * Returns `true` when the {@link #view} is visible in the {@link #_balloon}.\n   *\n   * @private\n   * @type {Boolean}\n   */\n\n\n  get _isViewVisible() {\n    return this._balloon.visibleView === this.view;\n  }\n  /**\n   * Returns `true` when the {@link #view} is in the {@link #_balloon}.\n   *\n   * @private\n   * @type {Boolean}\n   */\n\n\n  get _isViewInBalloon() {\n    return this._balloon.hasView(this.view);\n  }\n  /**\n   * Creates a callback that when executed upon the {@link #view view's} property change\n   * executes a related editor command with the new property value.\n   *\n   * @private\n   * @param {String} commandName\n   * @param {String} defaultValue The default value of the command.\n   * @returns {Function}\n   */\n\n\n  _getPropertyChangeCallback(commandName, defaultValue) {\n    return (evt, propertyName, newValue, oldValue) => {\n      // If the \"oldValue\" is missing and \"newValue\" is set to the default value, do not execute the command.\n      // It is an initial call (when opening the table properties view).\n      if (!oldValue && defaultValue === newValue) {\n        return;\n      }\n\n      this.editor.execute(commandName, {\n        value: newValue,\n        batch: this._undoStepBatch\n      });\n    };\n  }\n  /**\n   * Creates a callback that when executed upon the {@link #view view's} property change:\n   * * Executes a related editor command with the new property value if the value is valid,\n   * * Or sets the error text next to the invalid field, if the value did not pass the validation.\n   *\n   * @private\n   * @param {Object} options\n   * @param {String} options.commandName\n   * @param {module:ui/view~View} options.viewField\n   * @param {Function} options.validator\n   * @param {String} options.errorText\n   * @param {String} options.defaultValue\n   * @returns {Function}\n   */\n\n\n  _getValidatedPropertyChangeCallback(options) {\n    const {\n      commandName,\n      viewField,\n      validator,\n      errorText,\n      defaultValue\n    } = options;\n    const setErrorTextDebounced = debounce(() => {\n      viewField.errorText = errorText;\n    }, ERROR_TEXT_TIMEOUT);\n    return (evt, propertyName, newValue, oldValue) => {\n      setErrorTextDebounced.cancel(); // If the \"oldValue\" is missing and \"newValue\" is set to the default value, do not execute the command.\n      // It is an initial call (when opening the table properties view).\n\n      if (!oldValue && defaultValue === newValue) {\n        return;\n      }\n\n      if (validator(newValue)) {\n        this.editor.execute(commandName, {\n          value: newValue,\n          batch: this._undoStepBatch\n        });\n        viewField.errorText = null;\n      } else {\n        setErrorTextDebounced();\n      }\n    };\n  }\n\n}","map":{"version":3,"sources":["/Users/jaibhole/Documents/CS/cs-front/node_modules/@ckeditor/ckeditor5-table/src/tablecellproperties/tablecellpropertiesui.js"],"names":["Plugin","ButtonView","clickOutsideHandler","ContextualBalloon","getLocalizedColorOptions","normalizeColorOptions","TableCellPropertiesView","colorFieldValidator","getLocalizedColorErrorText","getLocalizedLengthErrorText","defaultColors","lengthFieldValidator","lineWidthFieldValidator","debounce","getTableWidgetAncestor","getBalloonCellPositionData","repositionContextualBalloon","tableCellProperties","getNormalizedDefaultProperties","ERROR_TEXT_TIMEOUT","propertyToCommandMap","borderStyle","borderColor","borderWidth","width","height","padding","backgroundColor","horizontalAlignment","verticalAlignment","TableCellPropertiesUI","requires","pluginName","constructor","editor","config","define","borderColors","backgroundColors","init","t","_defaultTableCellProperties","get","includeVerticalAlignmentProperty","includeHorizontalAlignmentProperty","includePaddingProperty","isRightToLeftContent","locale","contentLanguageDirection","_balloon","plugins","view","_createPropertiesView","_undoStepBatch","ui","componentFactory","add","set","label","icon","tooltip","listenTo","_showView","commands","Object","values","map","commandName","bind","toMany","areEnabled","some","isCommandEnabled","destroy","viewDocument","editing","document","borderColorsConfig","localizedBorderColors","backgroundColorsConfig","localizedBackgroundColors","defaultTableCellProperties","render","_hideView","operations","length","execute","keystrokes","data","cancel","selection","_isViewVisible","emitter","activator","_isViewInBalloon","contextElements","element","callback","colorErrorText","lengthErrorText","on","_getPropertyChangeCallback","_getValidatedPropertyChangeCallback","viewField","borderColorInput","errorText","validator","defaultValue","borderWidthInput","paddingInput","widthInput","heightInput","backgroundInput","_fillViewFormFromCommandValues","borderStyleCommand","entries","property","value","forEach","position","model","createBatch","focus","stopListening","saveButtonView","remove","visibleView","hasView","evt","propertyName","newValue","oldValue","batch","options","setErrorTextDebounced"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module table/tablecellproperties/tablecellpropertiesui\n */\n\nimport { Plugin } from 'ckeditor5/src/core';\nimport { ButtonView, clickOutsideHandler, ContextualBalloon, getLocalizedColorOptions, normalizeColorOptions } from 'ckeditor5/src/ui';\n\nimport TableCellPropertiesView from './ui/tablecellpropertiesview';\nimport {\n\tcolorFieldValidator,\n\tgetLocalizedColorErrorText,\n\tgetLocalizedLengthErrorText,\n\tdefaultColors,\n\tlengthFieldValidator,\n\tlineWidthFieldValidator\n} from '../utils/ui/table-properties';\nimport { debounce } from 'lodash-es';\nimport { getTableWidgetAncestor } from '../utils/ui/widget';\nimport { getBalloonCellPositionData, repositionContextualBalloon } from '../utils/ui/contextualballoon';\n\nimport tableCellProperties from './../../theme/icons/table-cell-properties.svg';\nimport { getNormalizedDefaultProperties } from '../utils/table-properties';\n\nconst ERROR_TEXT_TIMEOUT = 500;\n\n// Map of view properties and related commands.\nconst propertyToCommandMap = {\n\tborderStyle: 'tableCellBorderStyle',\n\tborderColor: 'tableCellBorderColor',\n\tborderWidth: 'tableCellBorderWidth',\n\twidth: 'tableCellWidth',\n\theight: 'tableCellHeight',\n\tpadding: 'tableCellPadding',\n\tbackgroundColor: 'tableCellBackgroundColor',\n\thorizontalAlignment: 'tableCellHorizontalAlignment',\n\tverticalAlignment: 'tableCellVerticalAlignment'\n};\n\n/**\n * The table cell properties UI plugin. It introduces the `'tableCellProperties'` button\n * that opens a form allowing to specify the visual styling of a table cell.\n *\n * It uses the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon plugin}.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class TableCellPropertiesUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ ContextualBalloon ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'TableCellPropertiesUI';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor ) {\n\t\tsuper( editor );\n\n\t\teditor.config.define( 'table.tableCellProperties', {\n\t\t\tborderColors: defaultColors,\n\t\t\tbackgroundColors: defaultColors\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\n\t\t/**\n\t\t * The default table cell properties.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:table/tablecellproperties~TableCellPropertiesOptions}\n\t\t */\n\t\tthis._defaultTableCellProperties = getNormalizedDefaultProperties(\n\t\t\teditor.config.get( 'table.tableCellProperties.defaultProperties' ),\n\t\t\t{\n\t\t\t\tincludeVerticalAlignmentProperty: true,\n\t\t\t\tincludeHorizontalAlignmentProperty: true,\n\t\t\t\tincludePaddingProperty: true,\n\t\t\t\tisRightToLeftContent: editor.locale.contentLanguageDirection === 'rtl'\n\t\t\t}\n\t\t);\n\n\t\t/**\n\t\t * The contextual balloon plugin instance.\n\t\t *\n\t\t * @private\n\t\t * @member {module:ui/panel/balloon/contextualballoon~ContextualBalloon}\n\t\t */\n\t\tthis._balloon = editor.plugins.get( ContextualBalloon );\n\n\t\t/**\n\t\t * The cell properties form view displayed inside the balloon.\n\t\t *\n\t\t * @member {module:table/tablecellproperties/ui/tablecellpropertiesview~TableCellPropertiesView}\n\t\t */\n\t\tthis.view = this._createPropertiesView();\n\n\t\t/**\n\t\t * The batch used to undo all changes made by the form (which are live, as the user types)\n\t\t * when \"Cancel\" was pressed. Each time the view is shown, a new batch is created.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:engine/model/batch~Batch}\n\t\t */\n\t\tthis._undoStepBatch = null;\n\n\t\teditor.ui.componentFactory.add( 'tableCellProperties', locale => {\n\t\t\tconst view = new ButtonView( locale );\n\n\t\t\tview.set( {\n\t\t\t\tlabel: t( 'Cell properties' ),\n\t\t\t\ticon: tableCellProperties,\n\t\t\t\ttooltip: true\n\t\t\t} );\n\n\t\t\tthis.listenTo( view, 'execute', () => this._showView() );\n\n\t\t\tconst commands = Object.values( propertyToCommandMap )\n\t\t\t\t.map( commandName => editor.commands.get( commandName ) );\n\n\t\t\tview.bind( 'isEnabled' ).toMany( commands, 'isEnabled', ( ...areEnabled ) => (\n\t\t\t\tareEnabled.some( isCommandEnabled => isCommandEnabled )\n\t\t\t) );\n\n\t\t\treturn view;\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {\n\t\tsuper.destroy();\n\n\t\t// Destroy created UI components as they are not automatically destroyed.\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/1341.\n\t\tthis.view.destroy();\n\t}\n\n\t/**\n\t * Creates the {@link module:table/tablecellproperties/ui/tablecellpropertiesview~TableCellPropertiesView} instance.\n\t *\n\t * @private\n\t * @returns {module:table/tablecellproperties/ui/tablecellpropertiesview~TableCellPropertiesView} The cell\n\t * properties form view instance.\n\t */\n\t_createPropertiesView() {\n\t\tconst editor = this.editor;\n\t\tconst viewDocument = editor.editing.view.document;\n\t\tconst config = editor.config.get( 'table.tableCellProperties' );\n\t\tconst borderColorsConfig = normalizeColorOptions( config.borderColors );\n\t\tconst localizedBorderColors = getLocalizedColorOptions( editor.locale, borderColorsConfig );\n\t\tconst backgroundColorsConfig = normalizeColorOptions( config.backgroundColors );\n\t\tconst localizedBackgroundColors = getLocalizedColorOptions( editor.locale, backgroundColorsConfig );\n\t\tconst view = new TableCellPropertiesView( editor.locale, {\n\t\t\tborderColors: localizedBorderColors,\n\t\t\tbackgroundColors: localizedBackgroundColors,\n\t\t\tdefaultTableCellProperties: this._defaultTableCellProperties\n\t\t} );\n\t\tconst t = editor.t;\n\n\t\t// Render the view so its #element is available for the clickOutsideHandler.\n\t\tview.render();\n\n\t\tthis.listenTo( view, 'submit', () => {\n\t\t\tthis._hideView();\n\t\t} );\n\n\t\tthis.listenTo( view, 'cancel', () => {\n\t\t\t// https://github.com/ckeditor/ckeditor5/issues/6180\n\t\t\tif ( this._undoStepBatch.operations.length ) {\n\t\t\t\teditor.execute( 'undo', this._undoStepBatch );\n\t\t\t}\n\n\t\t\tthis._hideView();\n\t\t} );\n\n\t\t// Close the balloon on Esc key press.\n\t\tview.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._hideView();\n\t\t\tcancel();\n\t\t} );\n\n\t\t// Reposition the balloon or hide the form if a table cell is no longer selected.\n\t\tthis.listenTo( editor.ui, 'update', () => {\n\t\t\tif ( !getTableWidgetAncestor( viewDocument.selection ) ) {\n\t\t\t\tthis._hideView();\n\t\t\t} else if ( this._isViewVisible ) {\n\t\t\t\trepositionContextualBalloon( editor, 'cell' );\n\t\t\t}\n\t\t} );\n\n\t\t// Close on click outside of balloon panel element.\n\t\tclickOutsideHandler( {\n\t\t\temitter: view,\n\t\t\tactivator: () => this._isViewInBalloon,\n\t\t\tcontextElements: [ this._balloon.view.element ],\n\t\t\tcallback: () => this._hideView()\n\t\t} );\n\n\t\tconst colorErrorText = getLocalizedColorErrorText( t );\n\t\tconst lengthErrorText = getLocalizedLengthErrorText( t );\n\n\t\t// Create the \"UI -> editor data\" binding.\n\t\t// These listeners update the editor data (via table commands) when any observable\n\t\t// property of the view has changed. They also validate the value and display errors in the UI\n\t\t// when necessary. This makes the view live, which means the changes are\n\t\t// visible in the editing as soon as the user types or changes fields' values.\n\t\tview.on(\n\t\t\t'change:borderStyle',\n\t\t\tthis._getPropertyChangeCallback( 'tableCellBorderStyle', this._defaultTableCellProperties.borderStyle )\n\t\t);\n\n\t\tview.on( 'change:borderColor', this._getValidatedPropertyChangeCallback( {\n\t\t\tviewField: view.borderColorInput,\n\t\t\tcommandName: 'tableCellBorderColor',\n\t\t\terrorText: colorErrorText,\n\t\t\tvalidator: colorFieldValidator,\n\t\t\tdefaultValue: this._defaultTableCellProperties.borderColor\n\t\t} ) );\n\n\t\tview.on( 'change:borderWidth', this._getValidatedPropertyChangeCallback( {\n\t\t\tviewField: view.borderWidthInput,\n\t\t\tcommandName: 'tableCellBorderWidth',\n\t\t\terrorText: lengthErrorText,\n\t\t\tvalidator: lineWidthFieldValidator,\n\t\t\tdefaultValue: this._defaultTableCellProperties.borderWidth\n\t\t} ) );\n\n\t\tview.on( 'change:padding', this._getValidatedPropertyChangeCallback( {\n\t\t\tviewField: view.paddingInput,\n\t\t\tcommandName: 'tableCellPadding',\n\t\t\terrorText: lengthErrorText,\n\t\t\tvalidator: lengthFieldValidator,\n\t\t\tdefaultValue: this._defaultTableCellProperties.padding\n\t\t} ) );\n\n\t\tview.on( 'change:width', this._getValidatedPropertyChangeCallback( {\n\t\t\tviewField: view.widthInput,\n\t\t\tcommandName: 'tableCellWidth',\n\t\t\terrorText: lengthErrorText,\n\t\t\tvalidator: lengthFieldValidator,\n\t\t\tdefaultValue: this._defaultTableCellProperties.width\n\t\t} ) );\n\n\t\tview.on( 'change:height', this._getValidatedPropertyChangeCallback( {\n\t\t\tviewField: view.heightInput,\n\t\t\tcommandName: 'tableCellHeight',\n\t\t\terrorText: lengthErrorText,\n\t\t\tvalidator: lengthFieldValidator,\n\t\t\tdefaultValue: this._defaultTableCellProperties.height\n\t\t} ) );\n\n\t\tview.on( 'change:backgroundColor', this._getValidatedPropertyChangeCallback( {\n\t\t\tviewField: view.backgroundInput,\n\t\t\tcommandName: 'tableCellBackgroundColor',\n\t\t\terrorText: colorErrorText,\n\t\t\tvalidator: colorFieldValidator,\n\t\t\tdefaultValue: this._defaultTableCellProperties.backgroundColor\n\t\t} ) );\n\n\t\tview.on(\n\t\t\t'change:horizontalAlignment',\n\t\t\tthis._getPropertyChangeCallback( 'tableCellHorizontalAlignment', this._defaultTableCellProperties.horizontalAlignment )\n\t\t);\n\t\tview.on(\n\t\t\t'change:verticalAlignment',\n\t\t\tthis._getPropertyChangeCallback( 'tableCellVerticalAlignment', this._defaultTableCellProperties.verticalAlignment )\n\t\t);\n\n\t\treturn view;\n\t}\n\n\t/**\n\t * In this method the \"editor data -> UI\" binding is happening.\n\t *\n\t * When executed, this method obtains selected cell property values from various table commands\n\t * and passes them to the {@link #view}.\n\t *\n\t * This way, the UI stays up–to–date with the editor data.\n\t *\n\t * @private\n\t */\n\t_fillViewFormFromCommandValues() {\n\t\tconst commands = this.editor.commands;\n\t\tconst borderStyleCommand = commands.get( 'tableCellBorderStyle' );\n\n\t\tObject.entries( propertyToCommandMap )\n\t\t\t.map( ( [ property, commandName ] ) => {\n\t\t\t\tconst defaultValue = this._defaultTableCellProperties[ property ] || '';\n\n\t\t\t\treturn [ property, commands.get( commandName ).value || defaultValue ];\n\t\t\t} )\n\t\t\t.forEach( ( [ property, value ] ) => {\n\t\t\t\t// Do not set the `border-color` and `border-width` fields if `border-style:none`.\n\t\t\t\tif ( ( property === 'borderColor' || property === 'borderWidth' ) && borderStyleCommand.value === 'none' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.view.set( property, value );\n\t\t\t} );\n\t}\n\n\t/**\n\t * Shows the {@link #view} in the {@link #_balloon}.\n\t *\n\t * **Note**: Each time a view is shown, a new {@link #_undoStepBatch} is created. It contains\n\t * all changes made to the document when the view is visible, allowing a single undo step\n\t * for all of them.\n\t *\n\t * @protected\n\t */\n\t_showView() {\n\t\tconst editor = this.editor;\n\n\t\t// Update the view with the model values.\n\t\tthis._fillViewFormFromCommandValues();\n\n\t\tthis._balloon.add( {\n\t\t\tview: this.view,\n\t\t\tposition: getBalloonCellPositionData( editor )\n\t\t} );\n\n\t\t// Create a new batch. Clicking \"Cancel\" will undo this batch.\n\t\tthis._undoStepBatch = editor.model.createBatch();\n\n\t\t// Basic a11y.\n\t\tthis.view.focus();\n\t}\n\n\t/**\n\t * Removes the {@link #view} from the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_hideView() {\n\t\tif ( !this._isViewInBalloon ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.editor;\n\n\t\tthis.stopListening( editor.ui, 'update' );\n\n\t\t// Blur any input element before removing it from DOM to prevent issues in some browsers.\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/1501.\n\t\tthis.view.saveButtonView.focus();\n\n\t\tthis._balloon.remove( this.view );\n\n\t\t// Make sure the focus is not lost in the process by putting it directly\n\t\t// into the editing view.\n\t\tthis.editor.editing.view.focus();\n\t}\n\n\t/**\n\t * Returns `true` when the {@link #view} is visible in the {@link #_balloon}.\n\t *\n\t * @private\n\t * @type {Boolean}\n\t */\n\tget _isViewVisible() {\n\t\treturn this._balloon.visibleView === this.view;\n\t}\n\n\t/**\n\t * Returns `true` when the {@link #view} is in the {@link #_balloon}.\n\t *\n\t * @private\n\t * @type {Boolean}\n\t */\n\tget _isViewInBalloon() {\n\t\treturn this._balloon.hasView( this.view );\n\t}\n\n\t/**\n\t * Creates a callback that when executed upon the {@link #view view's} property change\n\t * executes a related editor command with the new property value.\n\t *\n\t * @private\n\t * @param {String} commandName\n\t * @param {String} defaultValue The default value of the command.\n\t * @returns {Function}\n\t */\n\t_getPropertyChangeCallback( commandName, defaultValue ) {\n\t\treturn ( evt, propertyName, newValue, oldValue ) => {\n\t\t\t// If the \"oldValue\" is missing and \"newValue\" is set to the default value, do not execute the command.\n\t\t\t// It is an initial call (when opening the table properties view).\n\t\t\tif ( !oldValue && defaultValue === newValue ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editor.execute( commandName, {\n\t\t\t\tvalue: newValue,\n\t\t\t\tbatch: this._undoStepBatch\n\t\t\t} );\n\t\t};\n\t}\n\n\t/**\n\t * Creates a callback that when executed upon the {@link #view view's} property change:\n\t * * Executes a related editor command with the new property value if the value is valid,\n\t * * Or sets the error text next to the invalid field, if the value did not pass the validation.\n\t *\n\t * @private\n\t * @param {Object} options\n\t * @param {String} options.commandName\n\t * @param {module:ui/view~View} options.viewField\n\t * @param {Function} options.validator\n\t * @param {String} options.errorText\n\t * @param {String} options.defaultValue\n\t * @returns {Function}\n\t */\n\t_getValidatedPropertyChangeCallback( options ) {\n\t\tconst { commandName, viewField, validator, errorText, defaultValue } = options;\n\t\tconst setErrorTextDebounced = debounce( () => {\n\t\t\tviewField.errorText = errorText;\n\t\t}, ERROR_TEXT_TIMEOUT );\n\n\t\treturn ( evt, propertyName, newValue, oldValue ) => {\n\t\t\tsetErrorTextDebounced.cancel();\n\n\t\t\t// If the \"oldValue\" is missing and \"newValue\" is set to the default value, do not execute the command.\n\t\t\t// It is an initial call (when opening the table properties view).\n\t\t\tif ( !oldValue && defaultValue === newValue ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( validator( newValue ) ) {\n\t\t\t\tthis.editor.execute( commandName, {\n\t\t\t\t\tvalue: newValue,\n\t\t\t\t\tbatch: this._undoStepBatch\n\t\t\t\t} );\n\n\t\t\t\tviewField.errorText = null;\n\t\t\t} else {\n\t\t\t\tsetErrorTextDebounced();\n\t\t\t}\n\t\t};\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}